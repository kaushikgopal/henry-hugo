@layer base {
    html {
        /* keep .blog-content-width from shrinking on long pages where a scrollbar appears */
        scrollbar-gutter: stable both-edges;
    }

    article {
        /* prose-xl equivalent: 1.25rem (20px) base with 1.8 line-height */
        @apply space-y-6 text-ht text-xl leading-[1.8];
    }

    article > p {
        /* spacing between paragraphs */
        @apply mb-5;
        /* spacing between words*/
        word-spacing: 0.05em;
    }

    article p {
        @apply overflow-hidden text-ellipsis font-medium;
    }

    a {
        @apply underline decoration-2 decoration-solid decoration-ht-lighter underline-offset-4 hover:no-underline hover:text-hc;
    }

    a[href*='//'],
    a.external-link {
        @apply decoration-dotted;
    }

    article a {
        @apply text-ht;
    }
}

@layer components {
    /* ==========================================================================
       Post Content - Typography
       ========================================================================== */

    .post-content hr {
        @apply border-ht-lighter mt-6;
    }

    .post-content h1,
    .post-content h2,
    .post-content h3,
    .post-content h4,
    .post-content h5,
    .post-content h6 {
        @apply font-title font-bold;
    }

    .post-content h1 {
        /* prose-xl: 2.8em with line-height 1 */
        @apply mt-6 md:mt-10 text-ht-dark;
        font-size: 2.8em;
        line-height: 1;
    }

    .post-content h2 {
        @apply text-xl md:text-2xl mt-4 md:mt-6 text-ht-dark;
    }

    .post-content h2 + ul {
        @apply -mt-5;
    }

    .post-content h3 {
        @apply text-lg;
    }

    .post-content h4 {
        @apply font-semibold;
    }

    /* Heading anchors */
    .post-content h1,
    .post-content h2,
    .post-content h3,
    .post-content h4,
    .post-content h5,
    .post-content h6 {
        @apply relative;
    }

    .heading-anchor {
        @apply inline-block ml-2
               opacity-30 transition-opacity duration-200
               no-underline text-ht-lighter hover:text-hc
               font-normal;
    }

    /* ==========================================================================
       Post Content - Lists
       ========================================================================== */

    .post-content > ol,
    .post-content > ul {
        @apply ms-6 md:ms-8;
    }

    .callout ol,
    .callout ul {
        @apply ms-1 md:ms-2;
    }

    .post-content ol li,
    .post-content ul li {
        @apply ms-6;
    }

    .post-content ol li {
        @apply list-decimal;
    }

    .post-content ul li {
        @apply list-disc;
    }

    /* ==========================================================================
       Post Content - Code
       ========================================================================== */

    /* code blocks */
    .post-content pre {
        @apply p-4 border border-black rounded-md overflow-auto;
    }

    .post-content .highlight pre code {
        @apply text-xs;
    }

    /* inline code */
    .post-content code {
        @apply font-[550] text-[0.87em];
    }

    /* ==========================================================================
       Post Content - Layout & Figures
       ========================================================================== */

    /* sibling selector used to avoid width to apply in list page that has snippet on top */
    .blog-content-width + .post-content > *:not(figure.full-bleed) {
        @apply w-[75%] max-w-2xl min-w-[333px] mx-auto;
    }

    .post-content figure.full-bleed {
        @apply w-full border-l-0 border-r-0;
    }

    .post-content figure figcaption {
        @apply text-center no-underline font-bold text-xs pt-1;
    }

    .post-content *:not(figure.full-bleed) img {
        @apply border-4 border-black rounded-md;
    }

    .post-content figure.full-bleed img {
        width: 100%;
        @apply border-t-4 border-b-4 border-black;
    }

    .post-content figure img.borderless {
        @apply border-0;
    }

    /* ==========================================================================
       Post Content - Blockquotes & Asides
       ========================================================================== */

    .post-content blockquote {
        @apply bg-hbg-lightest p-6 font-semibold;
    }

    .post-content blockquote code {
        @apply text-sm;
    }

    .post-content .aside a {
        /* match this to the _shortcode aside */
        @apply text-ht-lighter;
    }

    /* ==========================================================================
       Footnotes
       ========================================================================== */

    .post-content .footnote-ref {
        @apply ps-0.5 text-ht-lighter hover:text-ht-light font-bold no-underline;
    }

    .post-content .footnote-backref {
        @apply font-bold text-hc2-dark no-underline hover:text-hc;
    }

    .post-content th {
        @apply border-b-2 border-ht-light py-2;
    }

    .footnotes ol {
        @apply list-decimal mt-2 py-2 pe-1 ps-4 text-sm text-ht-light;
    }

    .footnotes ol a {
        @apply decoration-ht-lighter;
    }

    /* ==========================================================================
       Pills / Tags
       ========================================================================== */

    .pill-hc2 {
        @apply w-fit border-2 border-hc2-dark rounded-lg px-1.5 py-0.5 bg-transparent hover:bg-hc2-dark text-hc2-dark hover:text-white uppercase no-underline font-sans text-xs;
        font-size: 10px;
    }

    section.post .pill-hc2 {
        @apply border-none;
    }

    .pill-hc2-solid {
        @apply w-fit border-2 border-hc2-dark rounded-lg px-1.5 py-0.5 bg-hc2-dark text-white uppercase no-underline font-sans font-bold;
        font-size: 10px;
    }

    .pill-hc {
        @apply w-fit border-2 border-hc rounded-lg p-1.5 bg-transparent hover:bg-hc text-hc hover:text-ht-lightest uppercase no-underline font-sans;
        font-size: 10px;
    }

    section.post .pill-hc {
        @apply border-none;
    }

    .pill-hc-solid {
        @apply w-fit border-2 border-hc rounded-lg px-1.5 py-0.5 bg-hc hover:bg-transparent text-black uppercase no-underline font-sans font-bold;
        font-size: 10px;
    }

    .pill-slate {
        @apply w-fit border-2 border-ht-light rounded-lg bg-transparent
             px-1.5 py-0
             hover:bg-ht-light text-ht-light hover:text-ht-lightest no-underline
             font-sans font-semibold uppercase;
    }

    section.post .pill-slate {
        @apply border-none;
    }

    /* ==========================================================================
       Pagination
       ========================================================================== */

    .pagination {
        @apply flex flex-wrap justify-center items-center space-x-2 my-8;
    }

    .page-item {
        @apply inline-block;
    }

    .page-item:nth-last-child(-n + 4):nth-last-child(n + 3) {
        @apply hidden sm:block;
    }

    .page-link {
        @apply px-3 py-2 border border-ht-lighter rounded-md text-ht hover:bg-hbg-dark hover:text-hc transition-colors duration-200 no-underline;
    }

    .page-item.active .page-link {
        @apply bg-hc text-black font-bold;
    }

    .page-item.disabled .page-link {
        @apply opacity-50 cursor-not-allowed hover:bg-transparent hover:text-ht;
    }

    /* ==========================================================================
       Callouts (Obsidian-style)
       ========================================================================== */

    .post-content .callout:not(figure) {
        @apply text-base md:text-lg;
    }

    /* Base callout structure */
    .callout {
        @apply relative overflow-hidden py-2 font-semibold;
        background: var(--color-hbg-lightest);
        border: 3px solid var(--color-hbg-dark);
    }

    .callout-icon {
        @apply flex items-center justify-center w-5 h-5 shrink-0;
        color: var(--callout-icon-color, #64748b);
    }

    .callout .callout-icon {
        @apply absolute z-0 w-9 h-9 pointer-events-none;
        opacity: 0.3;
        top: 0.4rem;
        left: 0.4rem;
    }

    .callout-icon svg {
        @apply w-full h-full;
    }

    .callout-title {
        @apply relative z-10 flex items-center gap-2 px-8 py-3 text-sm font-medium;
    }

    .callout-title code {
        @apply text-sm;
    }

    .callout-title-inner {
        @apply flex-1 font-bold;
    }

    .callout-fold {
        @apply w-5 h-5 flex items-center justify-center cursor-pointer transition-colors;
    }

    .callout-content {
        @apply relative z-10 px-8 py-3;
    }

    .callout-content > *:first-child {
        @apply mt-0;
    }

    .callout-content > *:last-child {
        @apply mb-0;
    }

    .callout-title + .callout-content {
        @apply pt-0;
    }

    /* Watermark icon styling */
    .callout-title:empty {
        display: none;
    }

    /* Callout variants - Note/Info/FYI */
    .callout[data-callout="note"],
    .callout[data-callout="info"],
    .callout[data-callout="fyi"] {
        --callout-icon-color: #2563eb;
    }

    /* Callout variants - TLDR */
    .callout[data-callout="tldr"] {
        --callout-icon-color: #0891b2;
    }

    /* Callout variants - Important/Tip/Hint */
    .callout[data-callout="important"],
    .callout[data-callout="tip"],
    .callout[data-callout="hint"] {
        --callout-icon-color: #ea580c;
    }

    /* Callout variants - Warning/Caution/Attention */
    .callout[data-callout="warning"],
    .callout[data-callout="caution"],
    .callout[data-callout="attention"] {
        --callout-icon-color: #f59e0b;
    }

    /* Callout variants - Error */
    .callout[data-callout="error"] {
        --callout-icon-color: #ef4444;
    }

    /* Callout variants - Failure/Fail/Missing */
    .callout[data-callout="failure"],
    .callout[data-callout="fail"],
    .callout[data-callout="missing"] {
        --callout-icon-color: #ec4899;
    }

    /* Callout variants - Bug */
    .callout[data-callout="bug"] {
        --callout-icon-color: #ef4444;
    }

    /* Callout variants - Example */
    .callout[data-callout="example"] {
        --callout-icon-color: #8b5cf6;
    }

    /* Callout variants - Quote/Cite */
    .callout[data-callout="quote"],
    .callout[data-callout="cite"] {
        --callout-icon-color: #64748b;
    }

    /* Callout variants - Question/Help/FAQ */
    .callout[data-callout="question"],
    .callout[data-callout="help"],
    .callout[data-callout="faq"] {
        --callout-icon-color: #22c55e;
    }
}

@layer utilities {
    .blog-content-width {
        @apply w-[75%] max-w-2xl min-w-[333px] mx-auto;
    }
}

/* ==========================================================================
   Media Queries (outside layers for proper cascade)
   ========================================================================== */

/* Heading anchor hover behavior - only on hover-capable devices */
@media (hover: hover) {
    .heading-anchor {
        @apply opacity-0;
    }

    .post-content h1:hover .heading-anchor,
    .post-content h2:hover .heading-anchor,
    .post-content h3:hover .heading-anchor,
    .post-content h4:hover .heading-anchor,
    .post-content h5:hover .heading-anchor,
    .post-content h6:hover .heading-anchor {
        @apply opacity-100;
    }
}

/* Dark mode - Callout adjustments */
@media (prefers-color-scheme: dark) {
    .callout {
        --callout-bg: color-mix(
            in srgb,
            var(--color-ht-lightest) 70%,
            black 30%
        );
    }

    .callout[data-callout="note"],
    .callout[data-callout="info"],
    .callout[data-callout="fyi"] {
        --callout-icon-color: #60a5fa;
    }

    .callout[data-callout="tldr"] {
        --callout-icon-color: #22d3ee;
    }

    .callout[data-callout="important"],
    .callout[data-callout="tip"],
    .callout[data-callout="hint"] {
        --callout-icon-color: #fb923c;
    }

    .callout[data-callout="warning"],
    .callout[data-callout="caution"],
    .callout[data-callout="attention"] {
        --callout-icon-color: #fbbf24;
    }

    .callout[data-callout="error"] {
        --callout-icon-color: #f87171;
    }

    .callout[data-callout="failure"],
    .callout[data-callout="fail"],
    .callout[data-callout="missing"] {
        --callout-icon-color: #f472b6;
    }

    .callout[data-callout="bug"] {
        --callout-icon-color: #f87171;
    }

    .callout[data-callout="example"] {
        --callout-icon-color: #a78bfa;
    }

    .callout[data-callout="quote"],
    .callout[data-callout="cite"] {
        --callout-icon-color: #ffffff;
    }

    .callout[data-callout="question"],
    .callout[data-callout="help"],
    .callout[data-callout="faq"] {
        --callout-icon-color: #4ade80;
    }
}
